{% extends "layout.html" %}
{% load static %}
{% block title %}Mapshare | Location in {{ territory }} {% endblock %}
{% block content%}
<p>{% if msg %}<script text="text/javascript">bootstrapAlert(`{{ msg }}`);window.history.pushState({}, "", `/`);</script>{% endif %}</p>

<!-- Mapcode Info Box class="fixed-bottom" -->
<div class="card fixed-bottom" style="bottom: 1%; left: 1%; width: 92%; background-color: #444444; z-index: 999;">
    <!-- <div class="card" style="width: 40%; background-color: #444444; z-index: 999; position: absolute; bottom: 2%; left: 2%;"> -->
    <div class="card-body">
        <button id="copyBtn" type="button" class="btn btn-outline-info btn-lg m-1" style="display: inline;">
            <span id="countryFlag">ðŸ‡¬ðŸ‡§</span>
            <h3 id="contextText" style="display: inline; color: white;"></h3>&nbsp
            <h2 id="mapcodeText" style="display: inline; color: white" title="This code represents this exact location!">
                <img height="35px" width="35px" src="{% static 'img/spinning.gif' %}"></img>
            </h2>&nbsp
            <i class="fa-solid fa-copy"></i>
        </button>
        <form style="display: inline-block">
                <input class="form-control p-2 m-1" type="text" placeholder="Enter Mapcode or address" aria-label="Enter Mapcode input">

        </form>
    </div>
    <div class="card-footer text-muted">
            <div class="dropdown">
                <button class="btn btn-outline-info btn-md m-1 dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" id="territoryCnt">
                    <i class="fa-solid fa-mountain-sun"></i> Territory: <strong id="territory"><img height="25px" width="25px" src="{% static 'img/spinning.gif' %}"></strong>
                </button>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item active" href="#" aria-current="true">GBR</a></li>
                    <li><a class="dropdown-item" href="#">ITA</a></li>
                    <li><a class="dropdown-item" href="#">International</a></li>
                </ul>
            </div>
    </div>
</div>

<!-- Top-Right Buttons -->
<div class="container-sm mt-5 me-5 gap-5" style="position: absolute; right: 2%;">
    <div class="row justify-content-end">
        <div class="col-1">
            <button id="locationBtn" type="button" class="btn btn-info btn-lg" title="Click to get mapcode for your current location" style="padding-right: 1.2em; padding-left: 1.2em;"><i class="fa-solid fa-location-arrow"></i></button>
        </div>
    </div>
    <div class="row justify-content-end mt-1">
        <div class="col-1">
            <button id="shareBtn" type="button" class="btn btn-info btn-lg" title="Click to share!" style="padding-right: 1.2em; padding-left: 1.2em;"><i class="fa-solid fa-share-nodes"></i></button>
        </div>
    </div>
    <div class="row justify-content-end mt-1">
        <div class="col-1">
            <button id="googleMapsBtn" type="button" class="btn btn-info btn-lg" title="Open in Google Maps"><img src="{% static 'img/google-maps.png' %}" style="max-width: 1.6em; height: auto;"></button>
        </div>
    </div>
</div>

<!-- Alert -->
<div id="alert-container" class="container-med"></div>

<!-- Map -->
<div id="map"></div>

<script type="text/javascript">
    const key = "{{ mapboxAPIKey }}";
    const debug = "{{ debug }}" == "True";
    const lookupData = {
        country: "{{ lookupCountry }}",
        countryCode: "{{ lookupCountryCode }}",
        context: "{{ lookupContext }}",
        region: "{{ lookupRegion }}",
        city: "{{ lookupCity }}",
        lat: {{ lookupLat }},
        lng: {{ lookupLng }}
    };
    const territory = "{{ territory }}";
    if (debug) console.log("Initial Lookup Data: ", lookupData);
    
    // Sanitise URL params and alert if not correct
    const pathArray = window.location.pathname.split("/").filter(n => n);
    const defaultCoords = {lat: lookupData.lat, lng: lookupData.lng};
    const defaultMapcode = {context: "{{ context }}", mapcode: "{{ mapcode }}"};
    const precision = 0;    // Default for easy mapcodes, higher number means more letters in mapcode. Don't forget to set in precision text element as well!
    let isFreshRequest = false;
    let response;
    let currentMarker;
    const territoryElem = document.getElementById("territory");
    const spinningGif = `<img height="35px" width="35px" src="{% static 'img/spinning.gif' %}"></img>`;
    const csrfToken = "{{ csrf_token }}";
    
    const mapcode = {};
    let coords = {lat: "{{ urlLat }}", lng: "{{ urlLng }}"};
</script>
<script type="text/javascript" src="{% static 'js/index.js' %}"></script>

{% endblock %}